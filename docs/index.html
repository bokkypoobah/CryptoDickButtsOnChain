<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CryptoDickButts On-Chain</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="description" content="CryptoDickButts On-Chain (c) Bok Consulting Pty Ltd 2022" />
    <meta name="author" content="BokkyPooBah" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@BokkyPooBah" />
    <meta name="twitter:creator" content="@BokkyPooBah" />
    <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="css/bootstrap-vue.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/bootstrap-vue-icons.min.css"/>
    <script src="js/vue.js"></script>
    <script src="js/bootstrap-vue.min.js"></script>
    <script src="js/bootstrap-vue-icons.min.js"></script>
    <script src="js/ethers-5.6.umd.min.js" type="application/javascript"></script>
    <script src="deploymentData.js"></script>

    <link rel="apple-touch-icon" sizes="57x57" href="images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="images/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body>
    <div id="app">
      <b-container fluid class="m-0 p-0">
        <b-navbar toggleable="sm" variant="light">
          <b-navbar-brand to="/" variant="primary">
            <b-avatar rounded variant="light" size="3.0rem" src="images/cryptodickbutt_1940.png" v-b-popover.hover.bottom="'gm'" class="ml-0"></b-avatar>
            <em v-b-popover.hover.bottom="'Gm gm gm'">CryptoDickButts On-Chain</em>
          </b-navbar-brand>
          <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>
        </b-navbar>

        <b-card no-body class="p-0 mt-0">
          <b-card-body class="m-0 p-1">
            <div class="d-flex flex-wrap m-0 p-0">
              <div class="mt-1 pr-1">
                <b-form-input type="text" size="sm" v-model.trim="tokenId" debounce="600" placeholder="tokenId, e.g., 1940"></b-form-input>
              </div>
              <div class="mt-1">
                <b-button size="sm" @click="retrieveOnChainImage" variant="primary" style="min-width: 80px;" v-b-popover.hover.top="'Retrieve on-chain image via the web3 connection'"><b-icon-cloud-download shift-v="+1" font-scale="0.9"></b-icon-cloud-download> Retrieve On-Chain Metadata & Image</b-button>
              </div>
              <div class="mt-1 flex-grow-1">
              </div>
              <div class="mt-1">
                <b-button size="sm" :pressed.sync="showInfo" variant="link" v-b-popover.hover.top="'Show info'"><span v-if="showInfo"><b-icon-info-circle-fill shift-v="+1" font-scale="1.0"></b-icon-info-circle-fill></span><span v-else><b-icon-info-circle shift-v="+1" font-scale="1.0"></b-icon-info-circle></span></b-button>
              </div>
              <div class="mt-1 flex-grow-1">
              </div>
            </div>

            <div v-if="showInfo">
              <b-card no-header no-body class="m-2 p-1">
                <b-card-body class="m-0 p-0">
                  <b-card-text class="m-1 p-1">
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="GIFEncoder:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0xFFb8011622aA191FAaD0F728F1257D72285089F1#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0xFFb8011622aA191FAaD0F728F1257D72285089F1</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="PixelRenderer:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0xD9E3096f23c82C0605bd6956F37FCcD82C3d17f9#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0xD9E3096f23c82C0605bd6956F37FCcD82C3d17f9</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="SVGWrapper:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0x00D84c231EF413bC293D969B0E7ced4317BED4Ba#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0x00D84c231EF413bC293D969B0E7ced4317BED4Ba</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="TokenURIBuilder:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0x72337A16A0C0b8Cd662269500dBB97d2b88F6932#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0x72337A16A0C0b8Cd662269500dBB97d2b88F6932</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbuttsMetadata:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0x3585A7017dE132aE2f57e260DfdC1394f878bB0E#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0x3585A7017dE132aE2f57e260DfdC1394f878bB0E</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbuttsBuilder:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0xDf70e9434195c90CBBe377b2648A89Dd4FbCAD05#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0xDf70e9434195c90CBBe377b2648A89Dd4FbCAD05</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbuttsStrings:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0xA049A08B5c10807aBDbd95Cf8dC24670D3e6CB91#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0xA049A08B5c10807aBDbd95Cf8dC24670D3e6CB91</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbuttsRandom:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0x45Fe023E9ed87F626d250E54a935781d852BC4D8#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0x45Fe023E9ed87F626d250E54a935781d852BC4D8</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbuttsChained:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/address/0x277a9984e8636c230C348A55314594769Cd63466#code'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0x277a9984e8636c230C348A55314594769Cd63466</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbutts Series 3 Collection:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://opensea.io/collection/cryptodickbutts-s3'" v-b-popover.hover.bottom="'View in OpenSea.io'" target="_blank">CryptoDickbutts</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="CryptoDickbutts Series 3 Contract:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://etherscan.io/token/0x42069abfe407c60cf4ae4112bedead391dba1cdb'" v-b-popover.hover.bottom="'View in Etherscan.io'" target="_blank">0x42069abfe407c60cf4ae4112bedead391dba1cdb</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="Collection Owner:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://twitter.com/CryptoDickbutts'" v-b-popover.hover.bottom="'View in Twitter.com'" target="_blank">@CryptoDickbutts</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="This Dapp GitHub:" class="mx-0 my-1 p-0">
                      <b-link :href="'https://github.com/bokkypoobah/CryptoDickButtsOnChain'" v-b-popover.hover.bottom="'View in GitHub.com. Feel free to clone and improve'" target="_blank">https://github.com/bokkypoobah/CryptoDickButtsOnChain</b-link>
                    </b-form-group>
                    <b-form-group label-cols="3" label-size="sm" label-align="right" label="" class="mx-0 mt-3 p-0">
                      Enjoy. And hello, from the past.
                      <br />
                      (c) BokkyPooBah / Bok Consulting Pty Ltd 2022. The MIT Licence.
                    </b-form-group>
                  </b-card-text>
                </b-card-body>
              </b-card>
            </div>

            <b-card no-header no-body class="m-2 p-1">
              <b-card-body class="m-0 p-0">

                <b-form-group label-cols="3" label-size="sm" label-align="right" label="" class="mx-0 my-1 p-0">
                  <b-avatar button rounded size="15rem" :src="tokenData && tokenData.imageData || null"></b-avatar>
                </b-form-group>
                <b-form-group label-cols="3" label-size="sm" label-align="right" label="name:" class="mx-0 my-1 p-0">
                  <b-form-input type="text" readonly size="sm" :value="tokenData && tokenData.name || 'Enter tokenId and click button'"></b-form-input>
                </b-form-group>
                <b-form-group label-cols="3" label-size="sm" label-align="right" label="attributes:" class="mx-0 my-1 p-0">
                  <div v-if="tokenData">
                    <b-row v-for="(attribute, i) in tokenData.attributes"  v-bind:key="i" class="m-0 p-0">
                      <b-col cols="2" class="mx-1 my-0 px-1 py-0 text-right"><font size="-3">{{ attribute.trait_type }}:</font></b-col>
                      <b-col cols="3" class="mx-1 my-0 px-1 py-0"><b><font size="-2">{{ attribute.value }}</font></b></font></b-col>
                    </b-row>
                  </div>
                </b-form-group>
                <b-form-group label-cols="3" label-size="sm" label-align="right" label="description:" class="mx-0 my-1 p-0">
                  <b-form-textarea size="sm" readonly :value="tokenData && tokenData.description || ''" rows="3" max-rows="10"></b-form-textarea>
                </b-form-group>
                <b-form-group label-cols="3" label-size="sm" label-align="right" label="external_url:" class="mx-0 my-1 p-0">
                  <b-link :href="tokenData && tokenData.external_url || ''" target="_blank">{{ tokenData && tokenData.external_url || '' }}</b-link>
                </b-form-group>
                <b-form-group label-cols="3" label-size="sm" label-align="right" label="image:" class="mx-0 my-1 p-0">
                  <b-form-textarea size="sm" readonly :value="tokenData && tokenData.image || ''" rows="3" max-rows="10"></b-form-textarea>
                </b-form-group>
                <b-form-group label-cols="3" label-size="sm" label-align="right" label="image_data:" class="mx-0 my-1 p-0">
                  <b-form-textarea size="sm" readonly :value="tokenData && tokenData.image_data || ''" rows="3" max-rows="10"></b-form-textarea>
                </b-form-group>
              </b-card-body>
            </b-card>
          </b-card-body>
        </b-card>
      </b-container>
    </div>

    <script>
      window.app = new Vue({
        el: '#app',
        data: {
          tokenId: 1940, // null,
          tokenData: null,
          metadata: null,
          imageSVG: null,
          generatedImageData: null,
          showInfo: false,
        },
        computed: {
        },
        methods: {
          async retrieveOnChainImage() {
            console.log("retrieveOnChainImage");
            let connected = true;
            if (!window.ethereum) {
              alert("Please use the https://metamask.io addon with Firefox, Chromium, Opera or Chrome, or any other other web3 browser, for web3 data retrieval. And refresh!");
              connected = false;
            } else if (!window.ethereum.isConnected()) {
              try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                connected = window.ethereum.isConnected();
              } catch (e) {
                console.log("window.ethereum.request error: " + e.message);
                connected = false;
              }
            }
            if (connected) {
              const provider = new ethers.providers.Web3Provider(window.ethereum);
              const network = await provider.getNetwork();
              const cdboc = new ethers.Contract(CDBOCADDRESS, CDBOCABI, provider);
              let tokenData = null;
              if (this.tokenId != null) {
                const tokenURI = await cdboc.tokenURI(this.tokenId);
                // this.generatedImageData = tokenURI;
                // console.log(JSON.stringify(tokenURI));
                let tokenURIDataBase64 = tokenURI.replace("data:application/json;base64,", "");
                // console.log(tokenURIDataBase64);
                let tokenMetadata = JSON.parse(atob(tokenURIDataBase64));
                console.log(JSON.stringify(tokenMetadata, null, 2));
                // this.metadata = tokenMetadata;
                let image = tokenMetadata.image_data;
                console.log(image);
                let svgDataBase64 = image.replace("data:image/svg+xml;base64,", "");
                console.log(svgDataBase64);
                let svg = atob(svgDataBase64);
                // document.getElementById('generatedSVGId').innerHTML = svg;
                tokenData = { ...tokenMetadata, svg, imageData: image };
              }
              this.tokenData = tokenData;
            }
          },
        },
      })
    </script>
  </body>
</html>
